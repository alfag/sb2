{% extends "../layout.njk" %}

{% block title %}Modifica Utente - {{ userToEdit.username if userToEdit else 'Selezione' }}{% endblock %}

{% block head %}
<link rel="stylesheet" href="/css/updateUser.css">
<link rel="stylesheet" href="/css/libs/fontawesome.min.css">
<style>
/* Override sfondo dal layout di base */
body {
    background: #fafafa !important;
    background-color: #fafafa !important;
    background-image: none !important;
}

/* Minimal Elegant Design - Compact Version */
.update-user-container {
    max-width: 700px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
    background: #fafafa;
    min-height: 100vh;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    color: #1a1a1a !important; /* Forza testo nero */
}

/* Forza testo nero per tutti gli elementi */
* {
    color: #1a1a1a !important;
}

/* Eccezioni per elementi che devono mantenere i loro colori */
.btn-primary, .btn-success, .btn-danger {
    color: white !important;
}

.card-header i, .form-text, .help-text {
    color: #6b7280 !important;
}

.subtitle {
    color: #6b7280 !important;
}

/* Pulsante Indietro in alto a sinistra */
.back-navigation {
    margin-bottom: 1rem;
}

.back-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 50%; /* Pulsante circolare */
    color: #374151 !important;
    text-decoration: none;
    font-size: 0.9rem;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.back-btn:hover {
    background: #f9fafb;
    border-color: #d1d5db;
    color: #1f2937 !important;
    text-decoration: none;
    transform: translateX(-3px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.back-btn i {
    font-size: 0.9rem !important;
    color: #374151 !important;
    transition: color 0.2s ease;
}

.back-btn:hover i {
    color: #1f2937 !important;
}

.back-btn i {
    font-size: 1rem !important;
    color: #374151 !important;
    transition: color 0.2s ease;
    font-weight: bold;
}

.back-btn:hover i {
    color: #1f2937 !important;
}

/* Fallback per freccia se Font Awesome non carica */
.arrow-fallback {
    font-size: 1.2rem !important;
    color: #374151 !important;
    font-weight: bold;
    line-height: 1;
    display: none; /* Nascosto di default, mostrato solo se necessario */
}

/* Mostra fallback se Font Awesome non √® disponibile */
.back-btn:not(:has(i[class*="fa-"])) .arrow-fallback,
.back-btn i:empty + .arrow-fallback {
    display: block;
}

.back-btn:hover .arrow-fallback {
    color: #1f2937 !important;
}

.update-user-header {
    text-align: center;
    margin-bottom: 2rem;
}

.update-user-header h1 {
    font-size: 1.6rem;
    font-weight: 300;
    color: #1a1a1a !important; /* Forza nero per i titoli */
    margin-bottom: 0.3rem;
    letter-spacing: -0.02em;
}

.update-user-header .subtitle {
    font-size: 0.9rem;
    color: #6b7280;
    font-weight: 400;
}

.user-card {
    background: white;
    border-radius: 6px;
    border: 1px solid #e5e7eb;
    margin-bottom: 1.5rem;
    transition: box-shadow 0.2s ease;
}

.user-card:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}

.card-header {
    border-bottom: 1px solid #f3f4f6;
    padding: 1rem 1.5rem;
    font-size: 0.95rem;
    font-weight: 500;
    color: #1a1a1a !important; /* Forza nero per header card */
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.card-header i {
    color: #9ca3af;
    font-size: 0.85rem;
}

.card-content {
    padding: 1.5rem;
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
}

@media (min-width: 768px) {
    .form-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

.form-group {
    margin-bottom: 0;
}

.form-group label {
    display: block;
    margin-bottom: 0.4rem;
    font-weight: 500;
    color: #1a1a1a !important; /* Forza nero per le label */
    font-size: 0.85rem;
}

.form-group label i {
    color: #9ca3af;
    margin-right: 0.3rem;
    font-size: 0.75rem;
}

.form-control {
    width: 100%;
    padding: 0.6rem 0.8rem;
    border: 1px solid #d1d5db;
    border-radius: 4px;
    font-size: 0.9rem;
    transition: all 0.2s ease;
    background: white;
    box-sizing: border-box;
    color: #1a1a1a !important; /* Forza nero per il testo degli input */
}

.form-control:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
}

.form-control::placeholder {
    color: #9ca3af !important; /* Grigio per placeholder */
}

.form-control option {
    color: #1a1a1a !important; /* Nero per le opzioni */
    background: white !important;
}

.password-input-container {
    position: relative;
}

.password-toggle {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    color: #9ca3af;
    transition: color 0.2s ease;
    font-size: 0.9rem;
}

.password-toggle:hover {
    color: #6b7280;
}

.help-text {
    font-size: 0.75rem;
    color: #6b7280 !important; /* Grigio per testi di aiuto */
    margin-top: 0.2rem;
}

.roles-section {
    background: #f9fafb;
    border-radius: 4px;
    padding: 1rem;
    border: 1px solid #f3f4f6;
}

.roles-current h3,
.add-role-form h3 {
    font-size: 0.9rem;
    font-weight: 500;
    color: #374151;
    margin-bottom: 0.8rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
}

.roles-current h3 i,
.add-role-form h3 i {
    color: #9ca3af;
    font-size: 0.8rem;
}

.roles-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    margin-bottom: 1rem;
}

.role-badge {
    background: #f3f4f6;
    color: #374151;
    padding: 0.3rem 0.6rem;
    border-radius: 16px;
    font-size: 0.75rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    border: 1px solid #e5e7eb;
}

.role-badge i {
    font-size: 0.7rem;
    color: #6b7280;
}

.role-remove-btn {
    background: none;
    border: none;
    color: #9ca3af;
    font-size: 0.7rem;
    cursor: pointer;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.role-remove-btn:hover {
    background: #fee2e2;
    color: #dc2626;
}

.add-role-form {
    background: white;
    border-radius: 4px;
    padding: 1rem;
    border: 1px solid #e5e7eb;
}

.form-row {
    display: flex;
    gap: 0.8rem;
    align-items: end;
    margin-bottom: 0.8rem;
}

@media (max-width: 768px) {
    .form-row {
        flex-direction: column;
        align-items: stretch;
    }
}

.brewery-selection {
    background: #f0f9ff;
    border: 1px solid #bae6fd;
    border-radius: 4px;
    padding: 0.8rem;
    margin-top: 0.8rem;
}

.btn {
    padding: 0.6rem 1rem;
    border: none;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    white-space: nowrap;
}

.btn i {
    font-size: 0.75rem;
}

.btn-primary {
    background: #3b82f6;
    color: white;
}

.btn-primary:hover {
    background: #2563eb;
}

.btn-success {
    background: #10b981;
    color: white;
}

.btn-success:hover {
    background: #059669;
}

.btn-secondary {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #d1d5db;
}

.btn-secondary:hover {
    background: #e5e7eb;
}

.btn-danger {
    background: #dc2626;
    color: white;
}

.btn-danger:hover {
    background: #b91c1c;
}

.actions-bar {
    display: flex;
    justify-content: center; /* Centra il pulsante Salva */
    align-items: center;
    gap: 0.8rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #f3f4f6;
}

@media (max-width: 768px) {
    .actions-bar {
        flex-direction: column;
        align-items: stretch;
    }
}

.flash-message {
    padding: 0.8rem;
    border-radius: 4px;
    margin-bottom: 1rem;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
}

.flash-success {
    background: #f0fdf4;
    color: #166534;
    border: 1px solid #bbf7d0;
}

.flash-error {
    background: #fef2f2;
    color: #991b1b;
    border: 1px solid #fecaca;
}

.debug-info {
    background: #fffbeb;
    border: 1px solid #fde68a;
    border-radius: 3px;
    padding: 0.4rem;
    font-size: 0.75rem;
    color: #92400e;
    margin-top: 0.4rem;
}

/* Danger Zone */
.user-card.danger-zone {
    border-color: #fecaca;
}

.user-card.danger-zone .card-header {
    background: #fef2f2;
    border-bottom-color: #fecaca;
    color: #991b1b;
}

/* Minimal animations */
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-8px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.brewery-selection {
    animation: slideDown 0.15s ease;
}
</style>
{% endblock %}

{% block content %}
<div class="update-user-container">
    {% if not userToEdit %}
        <!-- User Selection Card -->
        <div class="update-user-header">
            <h1><i class="fas fa-users"></i> Seleziona Utente</h1>
            <p class="subtitle">Scegli l'utente che desideri modificare</p>
        </div>
        
        <div class="user-card">
            <div class="card-header">
                <i class="fas fa-search"></i>
                Selezione Utente
            </div>
            <div class="card-content">
                <form method="get" action="/administrator/users/update">
                    <div class="form-group">
                        <label for="userUpdateId">
                            <i class="fas fa-user"></i> Utente
                        </label>
                        <select id="userUpdateId" name="userUpdateId" class="form-control" required>
                            <option value="">-- Seleziona un utente --</option>
                            {% for u in users %}
                                <option value="{{ u._id }}">{{ u.username }} ({{ u.role.join(', ') }})</option>
                            {% endfor %}
                        </select>
                        <small class="form-text text-muted">
                            Seleziona un utente dalla lista per procedere con la modifica
                        </small>
                    </div>
                    <div class="actions-bar">
                        <button type="submit" class="btn btn-primary" id="selectUserBtn" disabled>
                            <i class="fas fa-edit"></i> Modifica Utente
                        </button>
                    </div>
                </form>
            </div>
        </div>
    {% else %}
        <!-- User Edit Interface -->
        <!-- Pulsante Indietro in alto a sinistra -->
        <div class="back-navigation">
            <a href="/administrator/users/update" class="back-btn" title="Torna alla selezione utente">
                <i class="fas fa-arrow-left"></i>
            </a>
        </div>
        
        <div class="update-user-header">
            <h1><i class="fas fa-user-edit"></i> Modifica Utente</h1>
            <p class="subtitle">Gestisci i dettagli e i ruoli di <strong>{{ userToEdit.username }}</strong></p>
        </div>

        <!-- Flash Messages -->
        {% if message %}
        <div class="flash-messages">
            <div class="flash-message flash-{{ message.category }}">
                {{ message.text }}
            </div>
        </div>
        {% endif %}

        <!-- Main User Information Card -->
        <div class="user-card">
            <div class="card-header">
                Informazioni Principali
            </div>
            <div class="card-content">
                <form id="updateUserForm" method="post" action="/administrator/users/update/{{ userToEdit._id }}">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="username">
                                <i class="fas fa-at"></i> Username
                            </label>
                            <input type="text" id="username" name="username" class="form-control" 
                                   value="{{ userToEdit.username }}" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="password">
                                <i class="fas fa-lock"></i> Password
                            </label>
                            <div class="password-input-container">
                                <input type="password" id="password" name="password" class="form-control" 
                                       autocomplete="new-password"
                                       placeholder="Inserisci nuova password (lascia vuoto per non modificare)">
                                <button type="button" id="togglePassword" class="password-toggle" title="Mostra password">
                                    üëÅÔ∏è
                                </button>
                            </div>
                            <div class="help-text">Lascia vuoto per mantenere la password attuale</div>
                    </div>
                    
                    <div class="actions-bar">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Salva Modifiche
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Roles Management Card -->
        <div class="user-card">
            <div class="card-header">
                <i class="fas fa-users-cog"></i>
                Gestione Ruoli
            </div>
            <div class="card-content">
                <div class="roles-section">
                    <!-- Current Roles -->
                    <div class="roles-current">
                        <h3 style="margin-bottom: 1rem; color: #374151;">
                            <i class="fas fa-tags"></i> Ruoli Attuali
                        </h3>
                        {% if userToEdit.role.length > 0 %}
                        <div class="roles-list">
                            {% for role in userToEdit.role %}
                            <div class="role-badge">
                                <i class="fas fa-{% if role == 'customer' %}user{% elif role == 'brewery' %}industry{% else %}crown{% endif %}"></i>
                                {{ role|capitalize }}
                                {% if role != 'administrator' and role != 'customer' %}
                                <form method="post" action="/administrator/users/removeRole/{{ userToEdit._id }}" style="display:inline;">
                                    <input type="hidden" name="roleToRemove" value="{{ role }}">
                                    <button type="submit" class="role-remove-btn remove-role-btn" data-role="{{ role }}" title="Rimuovi ruolo">
                                        √ó
                                    </button>
                                </form>
                                {% elif role == 'customer' %}
                                <span class="role-badge-required" title="Ruolo obbligatorio - non rimovibile">
                                    <i class="fas fa-lock" style="font-size: 0.6rem; color: #9ca3af; margin-left: 0.2rem;"></i>
                                </span>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p style="color: #6b7280; font-style: italic;">Nessun ruolo assegnato</p>
                        {% endif %}
                    </div>

                    <!-- Default Role Selection -->
                    {% if not userToEdit.role.includes('administrator') %}
                    <div class="default-role-section" style="margin: 1.5rem 0; padding: 1rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid #3b82f6;">
                        <h3 style="margin-bottom: 1rem; color: #374151;">
                            <i class="fas fa-star"></i> Ruolo Predefinito
                        </h3>
                        <form method="post" action="/administrator/users/update/{{ userToEdit._id }}">
                            <div class="form-group" style="margin-bottom: 0.5rem;">
                                <label for="defaultRole">
                                    <i class="fas fa-user-tag"></i> Ruolo utilizzato per il login iniziale
                                </label>
                                <select id="defaultRole" name="defaultRole" class="form-control">
                                    <option value="customer" {% if userToEdit.defaultRole == 'customer' %}selected{% endif %}>Customer</option>
                                    <option value="brewery" {% if userToEdit.defaultRole == 'brewery' %}selected{% endif %}>Brewery</option>
                                </select>
                            </div>
                            <div class="help-text" style="margin-bottom: 1rem;">Questo ruolo verr√† utilizzato quando l'utente effettua il login</div>
                            <button type="submit" class="btn btn-primary btn-sm">
                                <i class="fas fa-save"></i> Aggiorna Ruolo Predefinito
                            </button>
                        </form>
                    </div>
                    {% endif %}

                    <!-- Add New Role -->
                    {% if not userToEdit.role.includes('administrator') %}
                    <div class="add-role-form">
                        <h3 style="margin-bottom: 1rem; color: #374151;">
                            <i class="fas fa-plus-circle"></i> Aggiungi Nuovo Ruolo
                        </h3>
                        <form method="post" action="/administrator/users/addRole/{{ userToEdit._id }}">
                            <div class="form-row">
                                <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                    <label for="addRole">Seleziona Ruolo</label>
                                    <select id="addRole" name="roleToAdd" class="form-control">
                                        <option value="">-- Seleziona un ruolo --</option>
                                        {% for r in ['customer','brewery'] if r not in userToEdit.role %}
                                            <option value="{{ r }}">
                                                {{ r|capitalize }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-plus"></i> Aggiungi
                                </button>
                            </div>
                            
                            <div id="brewerySelection" class="brewery-selection" style="display:none;">
                                <label for="breweryId">
                                    <i class="fas fa-industry"></i> Seleziona Birrificio
                                </label>
                                <select id="breweryId" name="breweryId" class="form-control">
                                    <option value="">-- Seleziona un birrificio --</option>
                                    {% for brewery in availableBreweries %}
                                        <option value="{{ brewery._id }}">{{ brewery.breweryName }}</option>
                                    {% endfor %}
                                </select>
                                <div class="help-text">
                                    √à necessario selezionare un birrificio per assegnare il ruolo brewery
                                </div>
                                {% if availableBreweries %}
                                <div class="debug-info">
                                    <i class="fas fa-database"></i>
                                    {{ availableBreweries.length }} birrifici disponibili nel sistema
                                </div>
                                {% endif %}
                            </div>
                        </form>
                    </div>
                    {% else %}
                    <div class="add-role-form" style="background: #f8f9fa; border: 1px solid #e9ecef;">
                        <p style="color: #6c757d; margin: 0; text-align: center; font-style: italic;">
                            Gli utenti administrator non possono avere ruoli aggiuntivi
                        </p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Role Details Cards -->
        {% if 'customer' in userToEdit.role %}
        <div class="user-card role-details customer-details">
            <div class="card-header">
                Dettagli Customer
            </div>
            <div class="card-content">
                <form method="post" action="/administrator/users/update/{{ userToEdit._id }}">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="customerName">
                                <i class="fas fa-signature"></i> Nome
                            </label>
                            <input type="text" id="customerName" name="customerName" class="form-control"
                                   value="{{ userToEdit.customerDetails.customerName }}">
                        </div>
                        <div class="form-group">
                            <label for="customerSurname">
                                <i class="fas fa-signature"></i> Cognome
                            </label>
                            <input type="text" id="customerSurname" name="customerSurname" class="form-control"
                                   value="{{ userToEdit.customerDetails.customerSurname }}">
                        </div>
                        <div class="form-group">
                            <label for="customerFiscalCode">
                                <i class="fas fa-id-card"></i> Codice Fiscale
                            </label>
                            <input type="text" id="customerFiscalCode" name="customerFiscalCode" class="form-control"
                                   value="{{ userToEdit.customerDetails.customerFiscalCode }}">
                        </div>
                        <div class="form-group">
                            <label for="customerBillingAddress">
                                <i class="fas fa-receipt"></i> Indirizzo di Fatturazione
                            </label>
                            <input type="text" id="customerBillingAddress" name="customerBillingAddress" class="form-control"
                                   value="{{ userToEdit.customerDetails.customerAddresses.billingAddress }}">
                        </div>
                        <div class="form-group">
                            <label for="customerShippingAddress">
                                <i class="fas fa-shipping-fast"></i> Indirizzo di Spedizione
                            </label>
                            <input type="text" id="customerShippingAddress" name="customerShippingAddress" class="form-control"
                                   value="{{ userToEdit.customerDetails.customerAddresses.shippingAddress }}">
                        </div>
                        <div class="form-group">
                            <label for="customerPhoneNumber">
                                <i class="fas fa-phone"></i> Numero di Telefono
                            </label>
                            <input type="text" id="customerPhoneNumber" name="customerPhoneNumber" class="form-control"
                                   value="{{ userToEdit.customerDetails.customerPhoneNumber }}">
                        </div>
                    </div>
                    <div class="actions-bar">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Salva Dettagli Customer
                        </button>
                    </div>
                </form>
            </div>
        </div>
        {% endif %}

        {% if 'brewery' in userToEdit.role %}
        <div class="user-card role-details brewery-details">
            <div class="card-header">
                <i class="fas fa-industry"></i>
                Dettagli Brewery
            </div>
            <div class="card-content">
                <form method="post" action="/administrator/users/update/{{ userToEdit._id }}">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="breweryName">
                                <i class="fas fa-building"></i> Nome Birrificio
                            </label>
                            <input type="text" id="breweryName" name="breweryName" class="form-control"
                                   value="{{ userToEdit.breweryDetails.breweryName }}" readonly>
                            <div class="help-text">Nome collegato dal birrificio associato</div>
                        </div>
                        <div class="form-group">
                            <label for="breweryDescription">
                                <i class="fas fa-align-left"></i> Descrizione Birrificio
                            </label>
                            <textarea id="breweryDescription" name="breweryDescription" class="form-control" rows="3"
                                      readonly>{{ userToEdit.breweryDetails.breweryDescription }}</textarea>
                            <div class="help-text">Descrizione collegata dal birrificio associato</div>
                        </div>
                        <div class="form-group">
                            <label for="breweryFiscalCode">
                                <i class="fas fa-id-card"></i> Codice Fiscale Birrificio
                            </label>
                            <input type="text" id="breweryFiscalCode" name="breweryFiscalCode" class="form-control"
                                   value="{{ userToEdit.breweryDetails.breweryFiscalCode }}" readonly>
                            <div class="help-text">Codice fiscale collegato dal birrificio associato</div>
                        </div>
                    </div>
                    <div class="actions-bar">
                        <a href="/administrator/breweries/{{ userToEdit.breweryDetails._id }}" class="btn btn-primary">
                            <i class="fas fa-external-link-alt"></i> Modifica Birrificio
                        </a>
                    </div>
                </form>
            </div>
        </div>
        {% endif %}

        {% if 'administrator' in userToEdit.role %}
        <div class="user-card role-details admin-details">
            <div class="card-header">
                <i class="fas fa-crown"></i>
                Dettagli Administrator
            </div>
            <div class="card-content">
                <form method="post" action="/administrator/users/update/{{ userToEdit._id }}">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="administratorName">
                                <i class="fas fa-user-shield"></i> Nome Administrator
                            </label>
                            <input type="text" id="administratorName" name="administratorName" class="form-control"
                                   value="{{ userToEdit.administratorDetails.administratorName }}">
                        </div>
                        <div class="form-group">
                            <label for="administratorPermission">
                                <i class="fas fa-key"></i> Permessi
                            </label>
                            <input type="text" id="administratorPermission" name="administratorPermission" class="form-control"
                                   value="{{ userToEdit.administratorDetails.administratorPermission }}">
                        </div>
                    </div>
                    <div class="actions-bar">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Salva Dettagli Administrator
                        </button>
                    </div>
                </form>
            </div>
        </div>
        {% endif %}

        <!-- Danger Zone -->
        <div class="user-card danger-zone">
            <div class="card-header">
                <i class="fas fa-exclamation-triangle"></i>
                Zona Pericolosa
            </div>
            <div class="card-content">
                <p style="color: #6b7280; margin-bottom: 1.5rem; font-size: 0.9rem;">
                    Le azioni in questa sezione sono irreversibili. Procedi con cautela.
                </p>
                <form id="deleteUserForm" method="post" action="/administrator/users/delete/{{ userToEdit._id }}">
                    <button type="button" id="deleteUserBtn" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Elimina Utente
                    </button>
                </form>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script src="/js/updateUser.js"></script>
<!-- Debug temporaneo -->
<script>
console.log('=== DEBUG RIMOZIONE RUOLI ===');
console.log('Pagina caricata:', window.location.href);
{% if userToEdit %}
console.log('UserToEdit presente: true');
console.log('Ruoli utente:', {{ userToEdit.role | dump | safe }});
{% else %}
console.log('UserToEdit presente: false');
{% endif %}

window.addEventListener('load', function() {
    console.log('Window loaded, controllo elementi...');
    const removeButtons = document.querySelectorAll('.remove-role-btn');
    console.log('Pulsanti rimozione trovati:', removeButtons.length);
    removeButtons.forEach((btn, index) => {
        console.log('Pulsante ' + index + ':', {
            role: btn.getAttribute('data-role'),
            form: btn.closest('form'),
            action: btn.closest('form') ? btn.closest('form').action : 'no form'
        });
    });
});
</script>
{% endblock %}